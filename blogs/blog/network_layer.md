---
title: 网络层小结
date: 2022-06-15
categories:
 - 计算机网络
tags:
 - 可恶的408
cover: /images/covers/love.png
---

愛言葉IV了，太快乐了

<!-- more -->

## 网络层的功能

### 异构互联网

物理层和链路层的协议设备什么的都可能不一样，在网络层进行抽象，使这些不同形态的互联网也能够进行通信。

### 路由与转发

1. 路由选择，按照分布式算法，动态选择变化的路由，根据路由协议构建**路由表**
2. 分组转发，根据转发表，找到合适的端口转发出去，根据路由表构建**转发表**

### SDN（Software Define Netword）

集中式的控制层面和分布式的数据层面，改变以往每个路由器都有数据和控制层面的情况，路由器的路由选择然间不需要的，通过远程服务器进行控制。

### 拥塞控制

主要判断看吞吐量

与流量控制，流量控制一般是接收端与发送端之间点对点的通信量的控制，主要任务是抑制发送端速率。而拥塞控制，是一个涉及全局性的问题，设计网络中的所有主机，路由器和所有导致网络传输能力下降的原因。

1. 开环控制，实现考虑好多好多因素，设计预防方案
2. 闭环控制，监测当前网络系统状态，检测哪里拥塞了，及时调整


## 路由算法与协议

- 静态路由算法，非自适应路由算法，管理员手工配置的，适用于较小型的网络，
- 动态路由算法，自适应路由算法，路由器之间交换信息，获取路由

### 距离-向量路由算法&RIP算法

记录路径的代价，选择最短路径。

Routing Information Protocol,记录到目的网络的距离，最多包含15个路由器，即跳数最大时15，任意两个路由器之间每个30秒广播一次RIP路由更新信息，仅相邻两个路由器交换信息，交换所有的信息。

**坏消息传得慢**的情况，假设A-B-C三个路由器，原先它们都是可达的，突然B到A不可达了，但C现在不知道他是不可达的，C认为它到A时可达的距离为2，B现在它存的到A距离为16，更新后，B认为他到A的距离为2+1，然后又向C更新数据，这样循环。下一跳路由一样时替换跳数，不一样是选择小的跳数。

### 链路状态路由算法&OSPF

每个参与的结点要有完全的网络拓扑信息。

Open Shortest Path First。与RIP区别：

1. 使用洪泛法，RIP向相邻发送
2. 发送本路由器与相邻路由器的链路状态，一些代价，RIP发送全部信息。
3. 链路状态发生变化，洪泛法更新，RIP定期更新
4. 属于网络层协议，RIP使用UDP，为传输层协议。

所有路由器有一个相同的链路状态数据库，根据Dijkstra最短路径算法，获取最优路径。存只存下一跳。也会有层次之分，上层主干，负责链接下层与其他自治域。

分组类型

1. 问候分组，发现和维护邻站可达性
2. 数据库描述分组，向邻站发送自己链路状态数据库中的所有的链路状态行目的摘要信息
3. 链路状态请求分组，请求详细的链路状态项目信息
4. 链路状态更新分组，用洪泛法更新全网链路状态
5. 链路状态确认分组，对更新分组确认。

差不多每10s，两个相邻的路由及交换一次问候分组，以便知道那些可达。刚开始工作时，路由器使用数据库描述分组与相邻路由器交换已有的链路数据摘要信息，使用请求分组获取缺少的链路状态项目的详细信息。交换多次就能同步全网的链路数据库。

### 路径-向量路由算法&BGP

Border Gateway Protocol，不同自治系统，路由器之间交换路由信息的协议，外部网关协议。不是最佳路由。基于TCP。每个自治系统需要有个BGP发言人，要给出到达一个网络经过的AS。

1. 打开Open报文，与BGP发言人建立关系
2. 更新Update报文，发送路由信息，撤销路由信息
3. 保活Keepalive报文，确认打开报文，周期性证实邻站关系
4. 通知Notification报文，发送检测到差错

### 层次路由

因特网将互联网划分成多个效地自治系统，自治系统内有内部网关协议IGP，自治系统间使用外部网关协议EGP。

OSPF，会将自治系统分成多个区域

## Ipv4

### Ipv4分组格式

固定头部20B,首部长度单位为4B。

1. 版本4b
2. 首部长度4b，最大长度为60B
3. 总长度16b，单位B，65535B，以太网最大传输单元MTU1500B，
4. 标识16b，没产生一个数据报，加一，用于管理接收，区分分片
5. 标志3b，最低位MF，More Fraction，1是0否，中间为DF，Don't Fraction 1是0否
6. 片偏移13b，分片后偏移量 offset 单位8B
7. 生命周期TTL 8b 可以经过多少个路由器
8. 协议8b 给上层什么协议处理
9. 首部校验和16b 只校验首部

分片要会分

### Ipv4地址

| 类型          | 地址   | 网络号 | 主机号 | 范围    |
| ------------- | ------ | ------ | ------ | ------- |
| A类           | 0XXXXX | 8      | 24     | 1~126   |
| B类           | 10XXXX | 16     | 16     | 128~191 |
| C类           | 110XXX | 24     | 8      | 192~223 |
| D类 （多播）  | 1110XX |        |        | 224~239 |
| E类  （保留） | 1111XX |        |        | 240~255 |

- 主机号全0，网络本身
- 主机号全1，本网络广播地址
- 127.x.x.x 环回自检（总是想到保罗大回环），表示任意主机本身，不可能作为目的地址出现在网络上。
- 0.0.0.0 本网络上的主机。
- 255.255.255.255 标识整个TCP/IP网络的广播地址。

特点太多了就不写了

### NAT

将专用网络地址转为共用地址，对外隐藏IP地址，节省空间。

- A类，1个A类网段，10.0.0.0~10.255.255.255
- B类，16个B类网段，172.16.0.0~172.32.255.255
- C类，256个C类网段，192.168.0.0~192.168.255.255

通过IP+端口的映射实现多个私有IP连一个共有IP，记录下转换表。

### 子网

在主机号里拿几位构成子网，收发数据是按照网络号先找网络，在找目的子网，再找主机。

### 子网掩码

一连串的1然后一连串的0，通过子网掩码知道那些事主机号，子网什么的，将子网掩码与IP号&一下，主机号全都是0了，得出相应的子网网络地址。

路由器中需要报完网络地址，子网掩码，下一条地址

### CIDR

效出ABC类的限制，形成网络前缀+主机号，CIDR就没有子网这个概念了，但还是用掩码

**路由聚合**，网络前缀有连续相同部分的IP地址可以把掩码往前提组成一个CIDR地址块，减少空间。就像寄信，寄到学校保安室，宿舍阿姨还是寝室门口一样。

### ARP

Address Resolution Protocol 将IP地址映射到MAC地址。

### DHCP

Dynamic Host Configuration Protocol 给主机动态分配IP地址。

### ICMP

Internet Control Message Protocol，网际控制报文协议。分为差错报文和询问报文

差错报文分为

1. 终点不可达，无法交付数据报
2. 源点抑制，拥塞而丢失数据报
3. 时间超过，TTL为0，所有片都扔掉
4. 参数问题，首部字段值不正确
5. 改变路由，重定向，

对差错报文不再差错，只对第一个分片差错，组播不差错，特殊地址不差错。

询问报文

1. 回送请求和回答报文，PING
2. 时间戳请求和回答报文
3. 地址掩码和回答报文
4. 路由器询问和通告报文


## Ipv6

- 更大空间
- 扩展层次结构
- 灵活的首部格式
- 改进的选项
- 允许协议扩充
- 即插即用
- 资源预分配
- 源点才能分片
- 首部长度单位8B
- 没有校验和

与Ipv4同时使用，隧道技术或双协议栈

## 组播

IGMP Internet Group Management Protocol

单播，多少个主机复制多少分，多播，路由器分叉赋值

多播转发树。

## 移动IP

- 移动结点，永久IP地址的移动结点
- 本地代理，移动结点到了新的位置，在归属网络中代表移动结点执行移动管理功能的实体，隧道技术
- 外部代理，外部网络帮助移动结点完成移动管理功能的实体


## 设备

**冲突域**，数据必然被发到的地址构成一个冲突域

**广播域**，数据所有可能会发送到的地址构成广播域

**路由器**，多输入输出的专用计算机，包含路由选择部分也叫控制部分，核心为路由选择处理及，分组转发部分包含交换结构，一组输入端口，一组输出端口。

路由表要包含，目的网络IP，子网掩码，下一条IP，接口。